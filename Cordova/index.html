<script src="cordova.js"></script>
<script>
document.addEventListener("deviceready", function() {
    function measure(name, action) {
        var startDate = new Date();

        return action().then(function() {
            var elapsedMilliseconds = new Date() - startDate;
            alert(name + ': ' + elapsedMilliseconds + 'ms');
        }).catch(function(e) {
            alert(e);
        });
    }

    measure("Primitives", function() {
        var promises = [];

        for (var i = 0; i < 50000; i++) {
            promises.push(new Promise(function(resolve, reject) {
                TestFixtures.methodWithXYZ(function(x) {
                    resolve(x);
                }, function(e) {
                    reject();
                }, i, i, i);
            }));
        }

        return Promise.all(promises);
    });

    measure("Strings", function() {
        var strings = [];
        for (var i = 0; i < 100; i++) {
            strings.push("abcdefghijklmnopqrstuvwxyz" + i);
        }

        var promises = [];
        for (var i = 0; i < 100000; i++) {
            promises.push(new Promise(function(resolve, reject) {
                TestFixtures.methodWithString(function(x) {
                    resolve(x);
                }, function(e) {
                    reject();
                }, strings[i % strings.length]);
            }));
        }

        return Promise.all(promises);
    });

    measure("Big data", function() {
        var promises = [];

        var array = [];
        for (var i = 0; i < (1 << 16); i++) {
            array.push(i);
        }

        for (var i = 0; i < 200; i++) {
            promises.push(new Promise(function(resolve, reject) {
                TestFixtures.methodWithBigData(function() {
                    resolve();
                }, function(e) {
                    reject();
                }, array);
            }));
        }

        return Promise.all(promises);
    });
}, false);
</script>
